{"ast":null,"code":"import * as d3 from 'd3';\nlet periodRange = 0;\n\nfunction getScale(width, height, dataRun) {\n  let minValue = Number.MAX_SAFE_INTEGER;\n  let maxValue = Number.MIN_SAFE_INTEGER;\n  const timeSeries = dataRun.timeSeries;\n  const timeSeriesMin = timeSeries[0][0];\n  const timeSeriesMax = timeSeries[timeSeries.length - 1][0];\n  const x = d3.scaleTime().range([0, width]);\n  const y = d3.scaleLinear().range([height, 0]);\n  minValue = minValue > timeSeriesMin ? timeSeriesMin : minValue;\n  maxValue = maxValue < timeSeriesMax ? timeSeriesMax : maxValue;\n  x.domain([minValue, maxValue]);\n  y.domain([-1, 1]);\n  return {\n    x,\n    y\n  };\n}\n\nconst d3Brush = d3.brushX();\nexport function drawBrush(element, width, onPeriodTimeChange, chartID) {\n  width -= 25;\n  const brushHeight = 43;\n  const xRange = d3.scaleTime().range([0, width]);\n  const brush = d3Brush.extent([[0, 0], [width, brushHeight]]);\n  const brushContext = element.append('g').attr('class', 'brushContext');\n  brushContext.append('g') // .attr('class', 'brush')\n  .attr('id', \"chart_\".concat(chartID)).attr('transform', 'translate(5, 3)').call(brush).call(brush.move, xRange.range());\n  brush.on('brush end', () => {\n    // updateBrushPeriod(d3.event.selection);\n    // brush.on('brush end', null);\n    d3.select('.brush').call(brush.move, d3.event.selection); // d3.select('#chart_5da80105abc56689357439e6').call(brush).call(brush.move, d3.event.selection);\n    // onPeriodTimeChange(d3.event.selection);\n    // periodRange = d3.event.selection;\n    // return periodRange;\n    // updateBrushPeriod(d3.event.selection);\n    // brushContext.call(brush.move, d3.event.selection);\n    // brushContext.nodes().map(node =>\n    //   d3.select(node)\n    //     .call(brush.move, eventRange)\n    //     .on('brush end', null),\n    // );\n  }); // const updateBrushPeriod = (periodRange) => {\n  //   console.log(periodRange);\n  // };\n  // const updateEventRange = function() {\n  //   if (d3.event.sourceEvent && d3.event.sourceEvent.type === 'zoom') return;\n  //   onPeriodTimeChange(d3.event.selection);\n  // console.log(range);\n  // brushContext.nodes().map(node =>\n  //   d3.select(node)\n  //     .call(brush.move, [0, 700])\n  //     .on('brush end', null),\n  // );\n  // brushContext\n  // .call(brush)\n  // .call(brush.move, [0, 700])\n  // .on('brush end', null);\n  // eventRange = d3.event.selection;\n  // onPeriodTimeChange(d3.event.selection);\n  // };\n  // brush.on('brush end', updateBrush);\n  // const onBrushChange = () => {\n  // if (d3.event.sourceEvent && d3.event.sourceEvent.type === 'zoom') return;\n  // updateChart([0, 500]);\n  // onPeriodTimeChange(d3.event.selection);\n  // };\n  // brush.on('brush end', updateBrush);\n}\nd3Brush.on('brush end', console.log('ihaa'));\nexport function updateBrushPeriod(eventRange) {\n  console.log(periodRange);\n  debugger; // const xRange = d3.scaleTime().range(eventRange);\n\n  const brush = d3.brushX().extent([[0, 0], eventRange]); // const brushContext = d3.select('.brush');\n\n  d3.select('#chart_5da80105abc56689357439e6').call(brush).call(brush.move, d3.event.selection); // debugger;\n  // brushContext;\n  // .call(brush)\n  // .call(brush.move, eventRange);\n  // .on('brush end', null);\n  // brushContext.nodes().map(node =>\n  //   d3.select(node)\n  //     .call(brush.move, eventRange)\n  //     .on('brush end', null),\n  // );\n  // brush.on('brush end', null);\n  // brushContext\n  //   .call(brush)\n  //   .call(brush.move, xRange.range());\n  // console.log(selectedPeriod);\n}\nexport function drawChart(width, height, dataRun, onPeriodTimeChange, selectedPeriod, chartID) {\n  const chartWidth = width - 35;\n  const timeSeries = dataRun.timeSeries,\n        eventWindows = dataRun.eventWindows;\n\n  const _getScale = getScale(chartWidth, height, dataRun),\n        x = _getScale.x,\n        y = _getScale.y;\n\n  const line = d3.line().x(d => x(d[0])).y(d => y(d[1]));\n  const highlightedEvents = eventWindows.map(event => timeSeries.slice(event[0], event[1] + 2));\n  const svg = d3.select(\"._\".concat(dataRun.id)).append('svg').attr('width', chartWidth).attr('class', 'wave-chart');\n  svg.append('path').attr('class', 'wave-data').attr('d', line(timeSeries)).attr('transform', 'translate(10, 6)');\n  highlightedEvents.map(event => svg.append('path').attr('class', 'wave-event').attr('transform', 'translate(10, 6)').attr('d', line(event)));\n  drawBrush(svg, width, onPeriodTimeChange, chartID);\n}","map":{"version":3,"sources":["/home/sergiu/Projects/mtv-react/src/components/Timeseries/Overview/chartUtils.js"],"names":["d3","periodRange","getScale","width","height","dataRun","minValue","Number","MAX_SAFE_INTEGER","maxValue","MIN_SAFE_INTEGER","timeSeries","timeSeriesMin","timeSeriesMax","length","x","scaleTime","range","y","scaleLinear","domain","d3Brush","brushX","drawBrush","element","onPeriodTimeChange","chartID","brushHeight","xRange","brush","extent","brushContext","append","attr","call","move","on","select","event","selection","console","log","updateBrushPeriod","eventRange","drawChart","selectedPeriod","chartWidth","eventWindows","line","d","highlightedEvents","map","slice","svg","id"],"mappings":"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","sourcesContent":["import * as d3 from 'd3';\n\nlet periodRange = 0;\nfunction getScale(width, height, dataRun) {\n  let minValue = Number.MAX_SAFE_INTEGER;\n  let maxValue = Number.MIN_SAFE_INTEGER;\n  const { timeSeries } = dataRun;\n  const timeSeriesMin = timeSeries[0][0];\n  const timeSeriesMax = timeSeries[timeSeries.length - 1][0];\n  const x = d3.scaleTime().range([0, width]);\n  const y = d3.scaleLinear().range([height, 0]);\n\n  minValue = minValue > timeSeriesMin ? timeSeriesMin : minValue;\n  maxValue = maxValue < timeSeriesMax ? timeSeriesMax : maxValue;\n  x.domain([minValue, maxValue]);\n  y.domain([-1, 1]);\n\n  return { x, y };\n}\n\nconst d3Brush = d3.brushX();\n\nexport function drawBrush(element, width, onPeriodTimeChange, chartID) {\n  width -= 25;\n  const brushHeight = 43;\n  const xRange = d3.scaleTime().range([0, width]);\n  const brush = d3Brush.extent([[0, 0], [width, brushHeight]]);\n  const brushContext = element.append('g').attr('class', 'brushContext');\n\n  brushContext\n    .append('g')\n    // .attr('class', 'brush')\n    .attr('id', `chart_${chartID}`)\n    .attr('transform', 'translate(5, 3)')\n    .call(brush)\n    .call(brush.move, xRange.range());\n\n\n  brush.on('brush end', () => {\n    // updateBrushPeriod(d3.event.selection);\n    // brush.on('brush end', null);\n    d3.select('.brush').call(brush.move, d3.event.selection);\n    // d3.select('#chart_5da80105abc56689357439e6').call(brush).call(brush.move, d3.event.selection);\n\n    // onPeriodTimeChange(d3.event.selection);\n\n    // periodRange = d3.event.selection;\n    // return periodRange;\n\n    // updateBrushPeriod(d3.event.selection);\n    // brushContext.call(brush.move, d3.event.selection);\n    // brushContext.nodes().map(node =>\n  //   d3.select(node)\n  //     .call(brush.move, eventRange)\n  //     .on('brush end', null),\n  // );\n  });\n\n  // const updateBrushPeriod = (periodRange) => {\n  //   console.log(periodRange);\n  // };\n\n  // const updateEventRange = function() {\n  //   if (d3.event.sourceEvent && d3.event.sourceEvent.type === 'zoom') return;\n  //   onPeriodTimeChange(d3.event.selection);\n    // console.log(range);\n\n\n    // brushContext.nodes().map(node =>\n    //   d3.select(node)\n    //     .call(brush.move, [0, 700])\n    //     .on('brush end', null),\n    // );\n\n    // brushContext\n    // .call(brush)\n    // .call(brush.move, [0, 700])\n    // .on('brush end', null);\n    // eventRange = d3.event.selection;\n    // onPeriodTimeChange(d3.event.selection);\n  // };\n\n\n  // brush.on('brush end', updateBrush);\n\n  // const onBrushChange = () => {\n    // if (d3.event.sourceEvent && d3.event.sourceEvent.type === 'zoom') return;\n    // updateChart([0, 500]);\n    // onPeriodTimeChange(d3.event.selection);\n  // };\n  // brush.on('brush end', updateBrush);\n}\n\nd3Brush.on('brush end', console.log('ihaa'));\n\nexport function updateBrushPeriod(eventRange) {\n  console.log(periodRange);\n  debugger;\n  // const xRange = d3.scaleTime().range(eventRange);\n  const brush = d3.brushX().extent([[0, 0], eventRange]);\n  // const brushContext = d3.select('.brush');\n\n\n  d3.select('#chart_5da80105abc56689357439e6').call(brush).call(brush.move, d3.event.selection);\n  // debugger;\n  // brushContext;\n    // .call(brush)\n    // .call(brush.move, eventRange);\n    // .on('brush end', null);\n  // brushContext.nodes().map(node =>\n  //   d3.select(node)\n  //     .call(brush.move, eventRange)\n  //     .on('brush end', null),\n  // );\n  // brush.on('brush end', null);\n\n  // brushContext\n  //   .call(brush)\n  //   .call(brush.move, xRange.range());\n  // console.log(selectedPeriod);\n}\n\nexport function drawChart(width, height, dataRun, onPeriodTimeChange, selectedPeriod, chartID) {\n  const chartWidth = width - 35;\n  const { timeSeries, eventWindows } = dataRun;\n  const { x, y } = getScale(chartWidth, height, dataRun);\n  const line = d3\n    .line()\n    .x(d => x(d[0]))\n    .y(d => y(d[1]));\n\n  const highlightedEvents = eventWindows.map(event => timeSeries.slice(event[0], event[1] + 2));\n  const svg = d3\n    .select(`._${dataRun.id}`)\n    .append('svg')\n    .attr('width', chartWidth)\n    .attr('class', 'wave-chart');\n\n  svg\n    .append('path')\n    .attr('class', 'wave-data')\n    .attr('d', line(timeSeries))\n    .attr('transform', 'translate(10, 6)');\n\n  highlightedEvents.map(event =>\n    svg\n      .append('path')\n      .attr('class', 'wave-event')\n      .attr('transform', 'translate(10, 6)')\n      .attr('d', line(event)),\n  );\n\n  drawBrush(svg, width, onPeriodTimeChange, chartID);\n}\n"]},"metadata":{},"sourceType":"module"}